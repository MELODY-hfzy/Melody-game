<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’€ è‡´å‘½æ‹äºº ğŸ’€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        .character-display {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .character-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .character-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .character-card.flr-active {
            border-color: #ff6b9d;
            box-shadow: 0 0 20px rgba(255, 107, 157, 0.5);
        }

        .character-card.feng-active {
            border-color: #4ecdc4;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.5);
        }

        .character-card.melody-active {
            border-color: #ffa726;
            box-shadow: 0 0 20px rgba(255, 167, 38, 0.5);
        }

        .character-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
        }

        .flr .character-avatar {
            background: linear-gradient(45deg, #ff6b9d, #ffa07a);
        }

        .fengleran .character-avatar {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
        }

        .melody .character-avatar {
            background: linear-gradient(45deg, #ffa726, #ff7043);
        }

        .character-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .affection-meter {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .affection-fill {
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 5px;
        }

        .flr .affection-fill {
            background: linear-gradient(90deg, #ff6b9d, #ffa07a);
        }

        .fengleran .affection-fill {
            background: linear-gradient(90deg, #4ecdc4, #44a08d);
        }

        .melody .affection-fill {
            background: linear-gradient(90deg, #ffa726, #ff7043);
        }

        .affection-text {
            font-size: 14px;
            color: #ccc;
        }

        .story-section {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            min-height: 200px;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .story-text {
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: 20px;
            min-height: 100px;
        }

        .warning-text {
            color: #ff4757;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(255, 71, 87, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .choices-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }

        .choice-btn {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .choice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .choice-btn.flr-choice {
            background: linear-gradient(45deg, #ff6b9d, #ffa07a);
        }

        .choice-btn.feng-choice {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
        }

        .choice-btn.melody-choice {
            background: linear-gradient(45deg, #ffa726, #ff7043);
        }

        .death-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .death-content {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #2c1810 0%, #8b0000 100%);
            border-radius: 20px;
            border: 2px solid #ff4757;
            max-width: 600px;
        }

        .death-title {
            font-size: 48px;
            color: #ff4757;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 71, 87, 0.8);
        }

        .death-message {
            font-size: 20px;
            line-height: 1.6;
            margin-bottom: 30px;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.5);
            padding: 15px 30px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .day-counter {
            font-size: 18px;
            color: #ffa726;
        }

        .danger-level {
            font-size: 18px;
            color: #ff4757;
            font-weight: bold;
        }

        .ending-gallery {
            display: flex;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .ending-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .ending-card.unlocked {
            border-color: #ffa726;
            box-shadow: 0 0 15px rgba(255, 167, 38, 0.3);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="status-bar">
            <div class="day-counter">ç¬¬ <span id="dayCount">1</span> å¤©</div>
            <div class="danger-level">å±é™©ç­‰çº§: <span id="dangerLevel">ä½</span></div>
        </div>

        <div class="character-display">
            <div class="character-card flr" id="flr-card">
                <div class="character-avatar">ğŸ’–</div>
                <div class="character-name">flr</div>
                <div class="affection-meter">
                    <div class="affection-fill" id="flr-affection" style="width: 0%"></div>
                </div>
                <div class="affection-text">å¥½æ„Ÿåº¦: <span id="flr-score">0</span></div>
            </div>

            <div class="character-card fengleran" id="feng-card">
                <div class="character-avatar">ğŸŒŠ</div>
                <div class="character-name">å†¯ä¹ç„¶</div>
                <div class="affection-meter">
                    <div class="affection-fill" id="feng-affection" style="width: 0%"></div>
                </div>
                <div class="affection-text">å¥½æ„Ÿåº¦: <span id="feng-score">0</span></div>
            </div>

            <div class="character-card melody" id="melody-card">
                <div class="character-avatar">ğŸµ</div>
                <div class="character-name">Melody</div>
                <div class="affection-meter">
                    <div class="affection-fill" id="melody-affection" style="width: 0%"></div>
                </div>
                <div class="affection-text">å¥½æ„Ÿåº¦: <span id="melody-score">0</span></div>
            </div>
        </div>

        <div class="story-section">
            <div class="story-text" id="storyText">
                ä½ æ˜¯ä¸€åæ™®é€šçš„å¤§å­¦ç”Ÿï¼Œè½¬å­¦åˆ°äº†æ¨±èŠ±å­¦å›­ã€‚åœ¨è¿™é‡Œï¼Œä½ é‡åˆ°äº†ä¸‰ä½æ€§æ ¼è¿¥å¼‚çš„å¥³å­©ã€‚
                å¥¹ä»¬çœ‹èµ·æ¥éƒ½å¾ˆå‹å¥½ï¼Œä½†ä½ æ€»æ„Ÿè§‰æœ‰äº›ä¸å¯»å¸¸çš„æ°”æ¯...
                <br><br>
                <span class="warning-text">è­¦å‘Š: åœ¨è¿™ä¸ªå­¦å›­é‡Œï¼Œä¸“ä¸€æ‰æ˜¯ç”Ÿå­˜ä¹‹é“ã€‚èƒŒå›çš„ä»£ä»·ï¼Œå¯èƒ½æ˜¯ä½ çš„ç”Ÿå‘½...</span>
            </div>
            <div class="choices-container" id="choicesContainer">
                <button class="choice-btn" onclick="startGame()">å¼€å§‹è¿™æ®µå±é™©çš„æ‹æƒ…</button>
            </div>
        </div>

        <div class="ending-gallery" id="endingGallery">
            <div class="ending-card">
                <div>ğŸ’• flr ç»“å±€</div>
                <div id="flr-ending">æœªè§£é”</div>
            </div>
            <div class="ending-card">
                <div>ğŸŒŠ å†¯ä¹ç„¶ ç»“å±€</div>
                <div id="feng-ending">æœªè§£é”</div>
            </div>
            <div class="ending-card">
                <div>ğŸµ Melody ç»“å±€</div>
                <div id="melody-ending">æœªè§£é”</div>
            </div>
            <div class="ending-card">
                <div>ğŸ’€ æ­»äº¡ç»“å±€</div>
                <div id="death-ending">æœªè§£é”</div>
            </div>
        </div>
    </div>

    <div class="death-screen" id="deathScreen">
        <div class="death-content">
            <div class="death-title">ğŸ’€ ä½ å·²æ­»äº¡ ğŸ’€</div>
            <div class="death-message" id="deathMessage"></div>
            <button class="choice-btn" onclick="restartGame()">é‡æ–°å¼€å§‹</button>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            day: 1,
            flrAffection: 0,
            fengAffection: 0,
            melodyAffection: 0,
            currentScene: 'start',
            flags: {},
            endings: {
                flr: false,
                feng: false,
                melody: false,
                death: false
            }
        };

        // åœºæ™¯æ•°æ®
        const scenes = {
            start: {
                text: `ä»Šå¤©æ˜¯è½¬å­¦çš„ç¬¬ä¸€å¤©ï¼Œä½ è¸å…¥äº†æ¨±èŠ±å­¦å›­çš„æ ¡é—¨ã€‚
                ä¸‰ä½å¥³å­©åŒæ—¶å‘ä½ èµ°æ¥ï¼Œå¥¹ä»¬çš„çœ¼ç¥ä¸­é—ªçƒç€ä¸åŒå¯»å¸¸çš„å…‰èŠ’...
                <br><br>
                <span class="warning-text">ä½ æ„Ÿå—åˆ°äº†å±é™©çš„é¢„æ„Ÿï¼Œå¿…é¡»è°¨æ…é€‰æ‹©...</span>`,
                choices: [
                    { text: "å‘flræ‰“æ‹›å‘¼", action: () => goToScene('flr_day1'), type: 'flr' },
                    { text: "å‘å†¯ä¹ç„¶é—®å¥½", action: () => goToScene('feng_day1'), type: 'feng' },
                    { text: "ä¸Melodyäº¤è°ˆ", action: () => goToScene('melody_day1'), type: 'melody' }
                ]
            },

            flr_day1: {
                text: `flréœ²å‡ºäº†ç”œç¾çš„ç¬‘å®¹ï¼š"æ–°æ¥çš„åŒå­¦å—ï¼Ÿæˆ‘å«flrï¼Œå¯ä»¥å¸¦ä½ å‚è§‚æ ¡å›­å“¦ï½"
                å¥¹çš„å£°éŸ³å¾ˆæ¸©æŸ”ï¼Œä½†çœ¼ç¥ä¸­ä¼¼ä¹éšè—ç€ä»€ä¹ˆ...
                <br><br>
                <span class="warning-text">å¥¹çœ‹èµ·æ¥å¾ˆå‹å¥½ï¼Œä½†ä½ çŸ¥é“å¥¹å¯èƒ½ä¸æ˜¯è¡¨é¢é‚£ä¹ˆå•çº¯...</span>`,
                choices: [
                    { text: "æ¥å—å¥¹çš„å¥½æ„", action: () => { addAffection('flr', 2); goToScene('flr_path'); }, type: 'flr' },
                    { text: "ç¤¼è²Œåœ°æ‹’ç»", action: () => { addAffection('flr', -1); goToScene('neutral_day1'); }, type: 'neutral' },
                    { text: "åŒæ—¶å…³æ³¨å…¶ä»–å¥³å­©", action: () => { goToScene('suspicious_day1'); }, type: 'dangerous' }
                ]
            },

            feng_day1: {
                text: `å†¯ä¹ç„¶æ·¡æ·¡åœ°çœ‹äº†ä½ ä¸€çœ¼ï¼š"æˆ‘å«å†¯ä¹ç„¶ï¼Œåˆ«æƒ¹éº»çƒ¦å°±è¡Œã€‚"
                å¥¹çš„è¯­æ°”å¾ˆå†·ï¼Œä½†ä½ èƒ½æ„Ÿå—åˆ°å¥¹å†…å¿ƒçš„å­¤ç‹¬...
                <br><br>
                <span class="warning-text">å¥¹åƒå†°å±±ä¸€æ ·ï¼Œä½†å†°å±±ä¸‹é¢å¯èƒ½æ˜¯ç‚½çƒ­çš„å²©æµ†...</span>`,
                choices: [
                    { text: "å°è¯•æ¥è¿‘å¥¹", action: () => { addAffection('feng', 2); goToScene('feng_path'); }, type: 'feng' },
                    { text: "ä¿æŒè·ç¦»", action: () => { addAffection('feng', -1); goToScene('neutral_day1'); }, type: 'neutral' },
                    { text: "æ•…æ„æŒ‘è¡…å¥¹", action: () => { addAffection('feng', -2); goToScene('danger_path'); }, type: 'dangerous' }
                ]
            },

            melody_day1: {
                text: `Melodyè½»å¿«åœ°è·³åˆ°ä½ é¢å‰ï¼š"å—¨ï¼æˆ‘æ˜¯Melodyï¼éŸ³ä¹ç¤¾çš„ç¤¾é•¿ï½"
                å¥¹çš„æ´»åŠ›å››å°„ï¼Œä½†ä½ æ³¨æ„åˆ°å¥¹çš„æ‰‹æŒ‡åœ¨å¾®å¾®é¢¤æŠ–...
                <br><br>
                <span class="warning-text">å¥¹çš„å¿«ä¹èƒŒåï¼Œä¼¼ä¹éšè—ç€æŸç§åæ‰§...</span>`,
                choices: [
                    { text: "è¡¨ç°å‡ºå…´è¶£", action: () => { addAffection('melody', 2); goToScene('melody_path'); }, type: 'melody' },
                    { text: "ä¿æŒç¤¼è²Œä½†ç–è¿œ", action: () => { addAffection('melody', -1); goToScene('neutral_day1'); }, type: 'neutral' },
                    { text: "é‚€è¯·æ‰€æœ‰äººä¸€èµ·æ´»åŠ¨", action: () => { goToScene('death_flag_day1'); }, type: 'deadly' }
                ]
            },

            neutral_day1: {
                text: `ä½ è¯•å›¾ä¿æŒä¸­ç«‹ï¼Œä½†ä½ èƒ½æ„Ÿå—åˆ°ä¸‰é“ç›®å…‰ä¸€ç›´åœ¨æ³¨è§†ç€ä½ ã€‚
                è¿™ç§è¢«ç›‘è§†çš„æ„Ÿè§‰è®©ä½ ä¸å¯’è€Œæ —...
                <br><br>
                <span class="warning-text">åœ¨è¿™ä¸ªå­¦å›­é‡Œï¼Œæ²¡æœ‰ä¸­ç«‹åœ°å¸¦ã€‚ä¸é€‰æ‹©ï¼Œå°±æ˜¯æ­»è·¯ä¸€æ¡...</span>`,
                choices: [
                    { text: "é€‰æ‹©flr", action: () => goToScene('flr_path'), type: 'flr' },
                    { text: "é€‰æ‹©å†¯ä¹ç„¶", action: () => goToScene('feng_path'), type: 'feng' },
                    { text: "é€‰æ‹©Melody", action: () => goToScene('melody_path'), type: 'melody' }
                ]
            },

            flr_path: {
                text: `flrä¼¼ä¹å¯¹ä½ çš„å…³æ³¨å¾ˆæ»¡æ„ï¼Œå¥¹å¼€å§‹é¢‘ç¹åœ°å‡ºç°åœ¨ä½ èº«è¾¹ã€‚
                "æˆ‘ä»¬ä¸€èµ·åƒåˆé¥­å§ï½"å¥¹é‚€è¯·é“ï¼Œçœ¼ä¸­é—ªçƒç€æœŸå¾…çš„å…‰èŠ’ã€‚
                ä½†ä½ èƒ½æ„Ÿå—åˆ°å¦å¤–ä¸¤é“å……æ»¡å«‰å¦’çš„ç›®å…‰...
                <br><br>
                <span class="warning-text">å†¯ä¹ç„¶å’ŒMelodyçš„çœ¼ç¥å˜å¾—å±é™©èµ·æ¥...</span>`,
                choices: [
                    { text: "åªå’Œflråƒé¥­", action: () => { addAffection('flr', 3); checkExclusivePath('flr'); }, type: 'flr' },
                    { text: "é‚€è¯·å…¶ä»–äººä¸€èµ·", action: () => { goToScene('balanced_social'); }, type: 'dangerous' },
                    { text: "æ•…æ„ç–è¿œflr", action: () => { addAffection('flr', -2); goToScene('back_to_neutral'); }, type: 'neutral' }
                ]
            },

            feng_path: {
                text: `å†¯ä¹ç„¶è™½ç„¶è¡¨é¢ä¸Šè¿˜æ˜¯å†·æ·¡ï¼Œä½†å¼€å§‹æ¥å—ä½ çš„å­˜åœ¨ã€‚
                "åˆ«è¯¯ä¼šï¼Œæˆ‘åªæ˜¯ä¸è®¨åŒä½ è€Œå·²ã€‚"å¥¹åˆ«è¿‡è„¸è¯´é“ï¼Œè€³å°–å´å¾®å¾®å‘çº¢ã€‚
                è¿™ç§æš§æ˜§çš„æ€åº¦è®©å…¶ä»–å¥³å­©æ›´åŠ è­¦è§‰...
                <br><br>
                <span class="warning-text">flrå’ŒMelodyå¼€å§‹æš—ä¸­è§‚å¯Ÿä½ ä»¬çš„ä¸€ä¸¾ä¸€åŠ¨...</span>`,
                choices: [
                    { text: "ä¸“æ³¨æ”»ç•¥å†¯ä¹ç„¶", action: () => { addAffection('feng', 3); checkExclusivePath('feng'); }, type: 'feng' },
                    { text: "ä¿æŒè‹¥å³è‹¥ç¦»", action: () => { goToScene('mixed_signals'); }, type: 'dangerous' },
                    { text: "çªç„¶å†·æ·¡å¥¹", action: () => { addAffection('feng', -3); goToScene('anger_path'); }, type: 'dangerous' }
                ]
            },

            melody_path: {
                text: `Melodyå˜å¾—è¶Šæ¥è¶Šä¾èµ–ä½ ï¼Œå¥¹è¦æ±‚ä½ æ¯å¤©éƒ½å»éŸ³ä¹ç¤¾é™ªå¥¹ã€‚
                "ä½ åªèƒ½å¬æˆ‘ä¸€ä¸ªäººçš„éŸ³ä¹å“¦ï¼"å¥¹æ’’å¨‡é“ï¼Œä½†è¯­æ°”ä¸­å¸¦ç€ä¸å®¹æ‹’ç»çš„æ‰§ç€ã€‚
                å¥¹çš„å æœ‰æ¬²å¼€å§‹æ˜¾ç°å‡ºæ¥...
                <br><br>
                <span class="warning-text">å¥¹çš„çˆ±å·²ç»å˜æˆäº†åæ‰§çš„æ§åˆ¶æ¬²...</span>`,
                choices: [
                    { text: "ç­”åº”å¥¹çš„è¦æ±‚", action: () => { addAffection('melody', 3); checkExclusivePath('melody'); }, type: 'melody' },
                    { text: "è¯•å›¾ä¿æŒè·ç¦»", action: () => { addAffection('melody', -2); goToScene('melody_jealous'); }, type: 'dangerous' },
                    { text: "å·å·æ¥è§¦å…¶ä»–äºº", action: () => { goToScene('secret_affair'); }, type: 'deadly' }
                ]
            },

            death_flag_day1: {
                text: `ä½ è¯•å›¾åŒæ—¶æ¥è¿‘æ‰€æœ‰äººï¼Œä½†è¿™æ˜¾ç„¶æ˜¯ä¸ªè‡´å‘½çš„é”™è¯¯ã€‚
                ä¸‰ä¸ªå¥³å­©çš„ç¬‘å®¹åŒæ—¶æ¶ˆå¤±äº†ï¼Œç©ºæ°”ä¸­å¼¥æ¼«ç€å±é™©çš„æ°”æ¯...
                <br><br>
                <span class="warning-text">"åŸæ¥ä½ æ˜¯ä¸ªèŠ±å¿ƒçš„äººå‘¢..."å¥¹ä»¬å¼‚å£åŒå£°åœ°è¯´é“ã€‚</span>`,
                choices: [
                    { text: "è¯•å›¾è§£é‡Š", action: () => triggerDeath('playboy_death'), type: 'deadly' },
                    { text: "é“æ­‰å¹¶é€‰æ‹©ä¸€äºº", action: () => goToScene('last_chance'), type: 'dangerous' },
                    { text: "ç»§ç»­è¿™ç§å±é™©æ¸¸æˆ", action: () => triggerDeath('greedy_death'), type: 'deadly' }
                ]
            }
        };

        // æ¸¸æˆå‡½æ•°
        function startGame() {
            gameState = {
                day: 1,
                flrAffection: 0,
                fengAffection: 0,
                melodyAffection: 0,
                currentScene: 'start',
                flags: {},
                endings: {
                    flr: false,
                    feng: false,
                    melody: false,
                    death: false
                }
            };
            updateDisplay();
            goToScene('start');
        }

        function goToScene(sceneName) {
            gameState.currentScene = sceneName;
            const scene = scenes[sceneName] || scenes.start;
            
            document.getElementById('storyText').innerHTML = scene.text;
            
            const choicesContainer = document.getElementById('choicesContainer');
            choicesContainer.innerHTML = '';
            
            scene.choices.forEach(choice => {
                const button = document.createElement('button');
                button.className = `choice-btn ${choice.type || ''}-choice`;
                button.textContent = choice.text;
                button.onclick = choice.action;
                choicesContainer.appendChild(button);
            });
            
            updateDisplay();
            checkDangerLevel();
        }

        function addAffection(character, amount) {
            gameState[character + 'Affection'] += amount;
            if (gameState[character + 'Affection'] < 0) {
                gameState[character + 'Affection'] = 0;
            }
            if (gameState[character + 'Affection'] > 10) {
                gameState[character + 'Affection'] = 10;
            }
            updateDisplay();
        }

        function updateDisplay() {
            // æ›´æ–°å¥½æ„Ÿåº¦
            document.getElementById('flr-score').textContent = gameState.flrAffection;
            document.getElementById('feng-score').textContent = gameState.fengAffection;
            document.getElementById('melody-score').textContent = gameState.melodyAffection;
            
            // æ›´æ–°è¿›åº¦æ¡
            document.getElementById('flr-affection').style.width = (gameState.flrAffection * 10) + '%';
            document.getElementById('feng-affection').style.width = (gameState.fengAffection * 10) + '%';
            document.getElementById('melody-affection').style.width = (gameState.melodyAffection * 10) + '%';
            
            // æ›´æ–°å¤©æ•°
            document.getElementById('dayCount').textContent = gameState.day;
            
            // æ›´æ–°å¡ç‰‡é«˜äº®
            document.querySelectorAll('.character-card').forEach(card => {
                card.classList.remove('flr-active', 'feng-active', 'melody-active');
            });
            
            if (gameState.flrAffection >= 5) {
                document.getElementById('flr-card').classList.add('flr-active');
            }
            if (gameState.fengAffection >= 5) {
                document.getElementById('feng-card').classList.add('feng-active');
            }
            if (gameState.melodyAffection >= 5) {
                document.getElementById('melody-card').classList.add('melody-active');
            }
        }

        function checkDangerLevel() {
            const totalAffection = gameState.flrAffection + gameState.fengAffection + gameState.melodyAffection;
            const maxAffection = Math.max(gameState.flrAffection, gameState.fengAffection, gameState.melodyAffection);
            const othersAffection = totalAffection - maxAffection;
            
            let dangerLevel = 'ä½';
            if (othersAffection >= 5 && maxAffection <= 7) {
                dangerLevel = 'æé«˜ - å·æƒ…é£é™©!';
            } else if (othersAffection >= 3) {
                dangerLevel = 'é«˜ - å«‰å¦’ç´¯ç§¯ä¸­';
            } else if (maxAffection >= 8) {
                dangerLevel = 'ä¸­ç­‰ - ä¸“ä¸€å®‰å…¨';
            } else if (maxAffection >= 5) {
                dangerLevel = 'ä½ - ç›¸å¯¹å®‰å…¨';
            }
            
            document.getElementById('dangerLevel').textContent = dangerLevel;
        }

        function checkExclusivePath(character) {
            const others = ['flr', 'feng', 'melody'].filter(c => c !== character);
            const othersAffection = others.reduce((sum, c) => sum + gameState[c + 'Affection'], 0);
            
            if (othersAffection >= 3) {
                // å…¶ä»–äººå¥½æ„Ÿåº¦å¤ªé«˜ï¼Œè§¦å‘è¿½æ€
                triggerDeath(character + '_revenge_death');
            } else if (gameState[character + 'Affection'] >= 8) {
                // ä¸“ä¸€æ”»ç•¥æˆåŠŸ
                triggerGoodEnding(character);
            } else {
                gameState.day++;
                goToScene(character + '_path_' + gameState.day);
            }
        }

        function triggerDeath(deathType) {
            const deathMessages = {
                playboy_death: {
                    title: "èŠ±å¿ƒè€…çš„ä¸‹åœº",
                    message: `ä½ è¯•å›¾åŒæ—¶è®¨å¥½æ‰€æœ‰äººï¼Œä½†å¥¹ä»¬éƒ½ä¸æ˜¯çœæ²¹çš„ç¯ã€‚
                    flrå¾®ç¬‘ç€é€’ç»™ä½ ä¸€æ¯"ç‰¹åˆ¶"çš„é¥®æ–™ï¼Œå†¯ä¹ç„¶"ä¸å°å¿ƒ"æ¨äº†ä½ ä¸€ä¸‹ï¼Œ
                    Melodyåˆ™æ¼”å¥äº†ä¸€æ›²"æ°¸åˆ«ä¹‹æ­Œ"ã€‚
                    <br><br>
                    ä½ çš„å°¸ä½“è¢«å‘ç°æ—¶ï¼Œè„¸ä¸Šè¿˜å¸¦ç€éš¾ä»¥ç½®ä¿¡çš„è¡¨æƒ…...`
                },
                greedy_death: {
                    title: "è´ªå©ªçš„ä»£ä»·",
                    message: `ä½ çš„è´ªå©ªè®©ä½ æƒ³è¦æ‹¥æœ‰ä¸€åˆ‡ï¼Œä½†è¿™æ˜¾ç„¶æ˜¯ä¸å¯èƒ½çš„ã€‚
                    ä¸‰ä¸ªå¥³å­©è¾¾æˆäº†å…±è¯†ï¼šæ—¢ç„¶ä¸èƒ½ç‹¬å ä½ ï¼Œé‚£å°±è°ä¹Ÿåˆ«æƒ³å¾—åˆ°ã€‚
                    <br><br>
                    ä½ çš„ç»“å±€æˆä¸ºäº†å­¦å›­é‡Œçš„è­¦ç¤ºæ•…äº‹...`
                },
                flr_revenge_death: {
                    title: "ç”œèœœçš„å¤ä»‡",
                    message: `flrå‘ç°äº†ä½ å¯¹å…¶ä»–äººçš„æš§æ˜§ï¼Œå¥¹çš„ç¬‘å®¹å˜å¾—æ›´åŠ "ç¿çƒ‚"ã€‚
                    "äº²çˆ±çš„ï¼Œæ¥å°å°æˆ‘ä¸ºä½ ç‰¹åˆ¶çš„å·§å…‹åŠ›å§ï½"
                    <br><br>
                    ä½ åƒä¸‹åï¼Œæ„Ÿè§‰å¿ƒè„åœæ­¢äº†è·³åŠ¨ï¼Œä½†å¥¹çš„ç¬‘å®¹æ°¸è¿œå°åœ¨äº†ä½ çš„è§†ç½‘è†œä¸Š...`
                },
                feng_revenge_death: {
                    title: "å†°å±±çš„æ„¤æ€’",
                    message: `å†¯ä¹ç„¶å¹³æ—¶å†·æ·¡ï¼Œä½†å«‰å¦’å¿ƒæå¼ºã€‚
                    å¥¹"é‚€è¯·"ä½ åˆ°æ¸¸æ³³æ± ï¼Œç„¶å"ä¸å°å¿ƒ"æŠŠä½ æ¨äº†ä¸‹å»ã€‚
                    <br><br>
                    ä½ ä¸ä¼šæ¸¸æ³³ï¼Œè€Œå¥¹åªæ˜¯ç«™åœ¨æ± è¾¹ï¼Œå†·å†·åœ°çœ‹ç€ä½ æ²‰å…¥æ°´åº•...`
                },
                melody_revenge_death: {
                    title: "éŸ³ä¹ç¤¾çš„å®‰é­‚æ›²",
                    message: `Melodyçš„å æœ‰æ¬²çˆ†å‘äº†ã€‚
                    "æ—¢ç„¶ä½ ä¸å±äºæˆ‘ä¸€ä¸ªäººï¼Œé‚£å°±æ°¸è¿œç•™åœ¨è¿™é‡Œå§..."
                    <br><br>
                    å¥¹ç”¨éŸ³ä¹ç¤¾çš„é’¢ç´çº¿"ä¸å°å¿ƒ"ç¼ ä½äº†ä½ çš„è„–å­ï¼Œ
                    ä½ çš„æœ€åæ—¶åˆ»ï¼Œä¼´éšç€å¥¹ä¸ºä½ åˆ›ä½œçš„"æ°¸æ’ä¹‹çˆ±"...`
                }
            };

            const death = deathMessages[deathType] || deathMessages.playboy_death;
            
            document.getElementById('deathMessage').innerHTML = `
                <div style="font-size: 24px; margin-bottom: 20px;">${death.title}</div>
                ${death.message}
            `;
            
            document.getElementById('deathScreen').style.display = 'flex';
            gameState.endings.death = true;
            document.getElementById('death-ending').textContent = 'å·²è§£é”';
        }

        function triggerGoodEnding(character) {
            const endings = {
                flr: {
                    title: "flr ç»“å±€ - ç”œèœœçš„å›šå¾’",
                    message: `ä½ é€‰æ‹©äº†flrï¼Œå¥¹æ¬£å–œè‹¥ç‹‚ã€‚
                    ä½†è¿™ä»½çˆ±æƒ…æ˜¯æœ‰ä»£ä»·çš„â€”â€”ä½ å°†æˆä¸ºå¥¹ä¸€ä¸ªäººçš„å® ç‰©ï¼Œ
                    æ°¸è¿œæ´»åœ¨å¥¹çš„ç”œèœœç‰¢ç¬¼ä¸­...`
                },
                feng: {
                    title: "å†¯ä¹ç„¶ ç»“å±€ - å†°å±±çš„æ¸©æŸ”",
                    message: `ä½ èåŒ–äº†å†¯ä¹ç„¶çš„å¿ƒï¼Œå¥¹å±•ç°å‡ºäº†ç½•è§çš„æ¸©æŸ”ã€‚
                    ä½†è¿™ä»½æ¸©æŸ”åªå±äºä½ ä¸€ä¸ªäººï¼Œå…¶ä»–äººéƒ½å°†æˆä¸ºä½ ä»¬çˆ±æƒ…çš„ç¥­å“...`
                },
                melody: {
                    title: "Melody ç»“å±€ - æ°¸æ’çš„æ—‹å¾‹",
                    message: `Melodyä¸ºä½ åˆ›ä½œäº†ä¸€ç”Ÿçš„æƒ…æ­Œã€‚
                    ä½ å°†æˆä¸ºå¥¹éŸ³ä¹ä¸­æ°¸æ’çš„ä¸»é¢˜ï¼Œæ°¸è¿œæ´»åœ¨å¥¹çš„æ—‹å¾‹é‡Œ...`
                }
            };

            const ending = endings[character];
            gameState.endings[character] = true;
            document.getElementById(character + '-ending').textContent = 'å·²è§£é”';
            
            document.getElementById('deathMessage').innerHTML = `
                <div style="font-size: 24px; margin-bottom: 20px; color: #ffa726;">${ending.title}</div>
                ${ending.message}
                <br><br>
                <div style="color: #4ecdc4;">æ­å–œä½ è¾¾æˆäº†ä¸“å±ç»“å±€ï¼</div>
            `;
            
            document.getElementById('deathScreen').style.display = 'flex';
        }

        function restartGame() {
            document.getElementById('deathScreen').style.display = 'none';
            startGame();
        }

        // æ·»åŠ æ›´å¤šåœºæ™¯ï¼ˆè¿™é‡Œåªæ˜¯ç¤ºä¾‹ï¼Œå®é™…æ¸¸æˆä¸­éœ€è¦æ›´å¤šå†…å®¹ï¼‰
        function checkBalancedAffection() {
            const affectionArray = [gameState.flrAffection, gameState.fengAffection, gameState.melodyAffection];
            const highCount = affectionArray.filter(a => a >= 3).length;
            
            if (highCount >= 2) {
                // è§¦å‘"å·é¸¡ä¸æˆèš€æŠŠç±³"ç»“å±€
                triggerDeath('greedy_death');
                return true;
            }
            return false;
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        window.onload = function() {
            updateDisplay();
        };
    </script>
</body>
</html>
